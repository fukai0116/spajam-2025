# WebSocket接続テスト手順

## 📋 テスト項目チェックリスト

### Phase 1: 基本接続テスト
- [ ] 1.1 WebSocketサーバー接続確認
- [ ] 1.2 プレイヤー参加イベント
- [ ] 1.3 切断処理

### Phase 2: ゲーム機能テスト
- [ ] 2.1 オートマッチング
- [ ] 2.2 ルーム作成
- [ ] 2.3 ダジャレ投稿・評価
- [ ] 2.4 投票システム
- [ ] 2.5 和を乱す人特殊能力

### Phase 3: 複数クライアントテスト
- [ ] 3.1 複数ブラウザで同時接続
- [ ] 3.2 リアルタイム同期確認
- [ ] 3.3 ゲームフロー統合

### Phase 4: Flutterクライアントテスト
- [ ] 4.1 Flutter WebSocketサービス接続
- [ ] 4.2 UI操作からの通信
- [ ] 4.3 リアルタイム状態更新

## 🧪 実行手順

### Step 1: ブラウザでの基本テスト

1. **テストページにアクセス**
   - URL: http://localhost:3000/test/websocket_test.html
   - プレイヤー名: "テストプレイヤー1"

2. **接続テスト**
   - 「接続」ボタンをクリック
   - 接続ステータスが「接続済み」に変わることを確認
   - ログに「WebSocket接続成功」が表示されることを確認

3. **プレイヤー参加テスト**
   - ログに「プレイヤー参加成功」が表示されることを確認

### Step 2: ゲーム機能テスト

1. **オートマッチングテスト**
   - 「オートマッチング」ボタンをクリック
   - ログに「オートマッチング開始」が表示されることを確認

2. **ルーム作成テスト**
   - 「ルーム作成」ボタンをクリック
   - ログに「ルーム作成成功」が表示されることを確認
   - ゲーム情報セクションに部屋情報が表示されることを確認

3. **ダジャレ投稿テスト**
   - ダジャレ入力欄に「アイスクリームは愛すクリーム」を入力
   - 「ダジャレ投稿」ボタンをクリック
   - ログにダジャレ評価結果が表示されることを確認

4. **特殊能力テスト**
   - 「和を乱す人能力使用」ボタンをクリック
   - ログに能力使用結果が表示されることを確認

5. **投票フェーズテスト**
   - 「投票開始」ボタンをクリック
  - ログに投票フェーズ開始が表示されることを確認（イベント: `voting_started`）

### Step 3: 複数クライアントテスト

1. **新しいブラウザタブで同じページを開く**
   - プレイヤー名: "テストプレイヤー2"
   - 両方のタブで接続

2. **リアルタイム同期確認**
   - 一方のタブでダジャレを投稿
   - もう一方のタブでリアルタイムに結果が反映されることを確認

### Step 4: Flutterクライアントテスト

1. **Flutterアプリでテストページにアクセス**
   - スタート画面の「WebSocketテスト」ボタンをタップ

2. **Flutter WebSocket接続テスト**
   - プレイヤー名を入力して「接続」ボタンをタップ
   - 接続状態が「接続済み」になることを確認

3. **ゲーム操作テスト**
   - 各ボタンの動作確認
   - イベントログの更新確認

## 🎯 期待される結果

### 正常ケース
- ✅ WebSocket接続が成功する
- ✅ サーバー側でクライアント接続ログが出力される
- ✅ イベントの送受信が正常に動作する
- ✅ ゲーム状態がリアルタイムで同期される
- ✅ 複数クライアント間でイベントが共有される

### エラーケース
- ❌ 接続エラーが適切にハンドリングされる
- ❌ 不正なデータに対してエラーメッセージが表示される
- ❌ サーバー停止時に適切に切断処理される

## 📊 ログ監視ポイント

### サーバー側ログ（ターミナル）
```
🔌 Player connected: [SocketID]
👤 プレイヤー参加: [PlayerName] ([PlayerID])（イベント: player_join → join_success）
🏠 ルーム作成: [RoomID]
😄 ダジャレ評価: "[Dajare]" スコア: [Score]
🐺 和を乱す人能力使用: [PlayerID]
```

### クライアント側ログ（ブラウザ）
```
[時刻] ✅ WebSocket接続成功
[時刻] 👤 プレイヤー参加: [PlayerName] ([PlayerID])
[時刻] 🏠 ルーム作成成功: [RoomData]（イベント: room_created）
[時刻] 😄 ダジャレ評価: "[Dajare]" 温度: [Temperature] 面白さ: [FunnyScore] 変化: [LifeDelta]（イベント: dajare_evaluated）
[時刻] 💬 AIコメント: [Comment]
```

## 🐛 トラブルシューティング

### 接続できない場合
1. バックエンドサーバーが起動しているか確認
2. ポート3000が使用可能か確認
3. ブラウザのコンソールでエラーメッセージを確認

### イベントが動作しない場合
1. WebSocket接続が確立されているか確認
2. サーバー側のログでエラーがないか確認
3. 送信データの形式が正しいか確認

### Flutter接続が失敗する場合
1. socket_io_clientパッケージが正しくインストールされているか確認
2. サーバーURLが正しく設定されているか確認
3. Flutter側のログでエラーメッセージを確認

---

**実行日時**: 2025年9月13日  
**テスト環境**: Windows, Node.js 18.x, Flutter 3.35.3  
**対象システム**: 最強あずき氷菓クラッシャー WebSocket統合システム
